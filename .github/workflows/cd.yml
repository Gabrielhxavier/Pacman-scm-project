name: CD - Pacman Workflow Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      - name: Build project
        run: |
          docker run --rm \
          -v $(pwd):/workspaces \
          -w /workspaces \
          pacman-ci \
          bash -c "
            echo 'Compilando projeto...';
            make;
            cp pacman_scm /workspaces/;
          "

      - name: Create binary distribution
        run: |
          echo "Creating distribution packages..."
          mkdir -p dist
          cp pacman_scm dist/
          cp README.md LICENSE dist/
          
          # Pacote TAR.GZ (original)
          tar -czf pacman_scm-${{ github.ref_name }}.tar.gz dist/
          echo "TAR package created: pacman_scm-${{ github.ref_name }}.tar.gz"
          
          # Pacote ZIP (adicionado)
          zip -r pacman_scm-${{ github.ref_name }}.zip dist/
          echo "ZIP package created: pacman_scm-${{ github.ref_name }}.zip"

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            pacman_scm-${{ github.ref_name }}.tar.gz
            pacman_scm-${{ github.ref_name }}.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}